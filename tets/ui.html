<link rel="stylesheet" href="styles.css">
<body style="background-color: #2E2929; color: #CCCCCC; font-family: 'Alata', sans-serif; margin: 0%; padding: 0%;">

  <h2 style="margin-top: 5%; margin-left: 3%; font-size: 25px;">ArtiFig</h2>
  <h4 class="text">Make you design easier and more unique with some of your own art! </h4>

  <button id="create" class="button">New</button>
  <button id="layers-look" class="button">View layer options</button>
  <button id="brush" class="button">Brush</button>
  <button id="eraser" class="button">Eraser</button>
  <button id="bucket" class="button">Bucket</button>

  <div class="popup" id="popup-save">
    <p class="popup-text">Make sure to select the frame you want to save and try again</p>
  </div>

  <div class="button-cont">
    <button id="save" class="half-button">Save</button>
    <button id="close" class="half-button">Close</button>
  </div>
</body>

<script>
  function saveAs(blob, filename) {
    let elem = window.document.createElement('a');
    elem.href = window.URL.createObjectURL(blob);
    elem.download = filename;

    // elem.setAttribute('style', 'display:none;opacity:0;color:transparent;')

    (document.body || document.documentElement).appendChild(elem);
    if (typeof elem.click === 'function') {
      elem.click();
    }
    else {
      elem.target = '_blank';
      elem.dispatchEvent(new MouseEvent('click', {
        view: window,
        bubbles: true,
        cancelable: true
      }));
    }

    URL.revokeObjectURL(elem.href);
  }

  document.getElementById('create').onclick = () => {
    //suzdavam frame
    /*const textbox = document.getElementById('count');
    const count = parseInt(textbox.value, 10);*/
    //parent.postMessage({ pluginMessage: { type: 'create', count } }, '*')

    parent.postMessage({ pluginMessage: { type: 'create' } }, '*')
  }

  document.getElementById('close').onclick = () => {
    parent.postMessage({ pluginMessage: { type: 'close' } }, '*')
  }

  document.getElementById('save').onclick = /*async*/ () => {
    // if (figma.currentPage.selection.length === 0 || figma.currentPage.type != 'FRAME') {
    parent.postMessage({ pluginMessage: { type: 'save' } }, '*')
    // }
    // else {

    // parent.postMessage({ pluginMessage: { type: 'save' } }, '*')
    document.getElementById('popup-save').style.display = 'none'
    // }
  }

  document.getElementById('layers-look').onclick = () => {
    parent.postMessage({ pluginMessage: { type: 'layers-look' } }, '*')
  }

  window.onmessage = async (msg) => {
    if (msg.data.pluginMessage.type === 'cant-save') {
      document.getElementById('popup-save').style.display = 'block'
    }
    if (msg.data.pluginMessage.type === 'can-save') {
      const imageBytes = await figma.currentPage.selection[0].exportAsync({ format: 'PNG' })
      const imageBlob = new Blob([imageBytes], { type: 'image/png' })
      let name = figma.currentPage.selection[0].name
      saveAs(imageBlob, names)
    }
  }

  // document.getElementById('brush').onclick =() =>{
  //   parent.postMessage({pluginMessage:{type: 'brush'}}, '*')
  // }
</script>